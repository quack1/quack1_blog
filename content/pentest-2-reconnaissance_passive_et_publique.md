Title: Pentest #2 - Reconnaissance passive et publique de la cible
Date: 2013-01-23 14:26
Author: Quack1
Category: Pentest
Slug: pentest_2_reconnaissance_passive
Tags: reconnaissance, passive, publique, pentest, serie_pentest

<div align=center><img src="static/upload/sparrow_longue_vue.png" width="600" height="250" align=center /></div>

_Nouvel article de la série consacrée au [pentest](./tag/serie_pentest.html "Tag : serie_pentest"), qui va traiter d'un partie totalement innofensive mais nécéssaire à tout audit : la reconnaissance passive de la cible_

Vous venez de décrocher un contrat d'audit, dans lequel est stipulé que vous devez auditer un système d'information complet.

Problème : vous ne disposez d'aucune informations concernant la société à auditer, hormis l'url de son site web : http://www.montest.fr/. Ça ne fait pas grand chose pour commencer à essayer d'exploiter des failles. Se présentent donc à vous 2 opportunités : 

1. Balancer des attaques à l'arrache en testant tous les softs installés dans votre BackTrack en vous disant que, dans le tas, il y en aura bien un ou deux qui trouvera des failles ;
2. Ou bien, vous vous posez 5 minutes pour réfléchir, et vous pensez, comme moi, qu'il est plus intelligent de recueillir le plus d'informations possibles sur la cible avant de vous lancer dans l'audit en lui même.

Et c'est justement de ce second point que je vais essayer de vous parler dans cet article :-)

&nbsp;

Nous allons dans cet article parler de la **reconnaissance passive** de votre cible. C'est à dire que nous allons essayer d'obtenir le plus d'informations possible sur le système distant, sans **jamais** n'accéder à ce serveur. Ce qui signifie que nous ne visiterons pas le site web (quoi que, on verra plus tard que ça peut être interessant), on ne lancera pas de scan des machines et adresses ip, etc...

&nbsp;

# In the Beginning was the DNS

Les premières informations **publiques** associées à un nom de domaine et qui pourront être utiles à des auditeurs sont les informations contenues dans les DNS.

## Petit rappel

Quand on navigue sur Internet, on nomme généralement les machines par des noms simples et faciles à retenir, comme `quack1.no-ip.org`. Cependant, afin d'être accessibles sur l'Internet, les machines doivent être contactées par des adresses IP.

Afin de faire le lien entre un nom de domaine et une adresse IP, on renseigne des enregistrements DNS. N'étant pas un pro du DNS, je ne vais pas vous faire l'affront de vous expliquer plus en détail son fonctionnement, il faut juste retenir que nous pouvons avoir plusieurs types d'enregistrements qui nous interesseront : 

- `A` : Adresses IPv4
- `AAAA` : Adresses IPv6
- `MX` : Adresse IP des serveurs de mail

Ce sont ces valeurs que nous chercherons, et nous allons donc voir comment.

## Back to the main topic

Si vous devez réaliser un audit, vous avez sûrement obtenu comme première information le nom de domaine de la société que vous allez devoir auditer. Pour les besoins de cet article, utilisons `http://scanme.org/`, un service proposé par [le projet nmap](http://nmap.org/) (que nous verrons plus en détail dans le prochain article) pour tester leur outil de scan.

Nous allons donc l'utiliser pour tester nos commandes en essayant d'obtenir le maximum d'informations publiques sur ce domaine. En particulier en inspectant les informations contenus dans les DNS.

Le premier outil utile est **dig**, qui va nous permettre d'interroger les serveurs DNS. Je vais ici vous donner une petite série de commandes à connaître, ainsi que leur utilisation et les informations que l'on pourra en tirer.

- `dig <type d'enregistrement> <hôte>` : On va ici interroger les serveurs DNS pour obtenir les enregistrements du type `<type d'enregistrement>` pour le nom d'hôte `<hôte>`

<div align=center><a href="static/upload/dig_A.png"><img src="static/upload/dig_A.png" align="center"/></a></div>
<div align=center><a href="static/upload/dig_AAAA.png"><img src="static/upload/dig_AAAA.png" align="center"/></a><br/>On note ici qu'il n'y a pas de section <code>;; ANSWER SECTION:</code>, ce qui signifie que l'hôte n'a pas d'enregistrement DNS AAAA.</div>
<div align=center><a href="static/upload/dig_MX.png"><img src="static/upload/dig_MX.png" align="center"/></a><br/>Ici, la commande <code>dig</code> nous renvoie un nom de domaine différent de <code>scanme.org</code>. Il faudra faire attention à ne pas l'attaquer s'il ne fait pas partie du périmètre de notre audit.</div>
<div align=center><a href="static/upload/dig_ANY.png"><img src="static/upload/dig_ANY.png" align="center"/></a><br/>Enfin, avec <code>dig</code> on peut effectuer une requête pour obtenir tous les enregistrements disponibles pour un hôte donné.</div>
<div align=center><a href="static/upload/dig_-x.png"><img src="static/upload/dig_-x.png" align="center"/></a><br/>Bonus : avec un <code>dig -x</code> suivi d'une adresse IP, il est possible de récupérer les noms d'hôtes connus qui sont enregistrés dans les DNS avec l'adresse IP donnée. Ce cas vous permettra de déterminer si vous travaillez sur un site web hebergé sur un hébergement mutualisé ou, comme ici, si plusieurs services web tournent au même endroit derrière la même IP.</div>

&nbsp;

Si vous souhaitez automatiser ces requêtes et avoir un affichage un peu plus user-friendly que `dig` qui est plutôt destiné aux admins DNS, il existe un petit outil écrit en Perl nommé [DNSenum](https://code.google.com/p/dnsenum/ "DNSenum sur Google Code").

Très simple d'utilisation, il va pouvoir vous afficher, de façon non exhaustive : 

- Les adresses IP de l'hôte
- Les serveurs de nom de référence (et leur adresse IP)
- Les adresses des serveurs de mail

Enfin, il peut également effectuer un "brute-force" pour récuperer les sous-domaines existants pour le nom d'hôte donné en paramètre. Cette recherche ne sera pas non plus "active" sur votre cible, puisque le brute-force sera effectué via des recherches Google afin de vérifier si les domaines en question existent ou non.

Le programme se lance très simplement, en ligne de commande :

	:::bash
	quack@spiderman:$ perl dnsenum.pl scanme.org

Si vous souhaitez tester le "brute-force" des sous-domaines, DNSenum vous fourni un fichier <code>dns.txt</code> qui est en fait un dictionnaire des noms de sous domaines DNS les plus utilisés (si vous souhaitez lancer des attaques plus ciblées, vous pourrez tenter de vous procurer des dictionnaires spécifiques, contenant par exemple des noms tirés de _Star Wars_, ou encore contenant des noms de bières par milliers (exemple présent particulièrement dans le Nord de la France... ;-) )).

	:::bash
	quack@spiderman:$ perl dnsenum.pl scanme.org -f dns.txt

Je vous laisse jouer avec les options du logiciel pour tester des choses plus avancées, et à les partager en commentaires.

<div align=center><a href="static/upload/dnsenum.png"><img src="static/upload/dnsenum.png" align="center" width="500"/></a></div>


<em>Image d'en-tête tirée de Pirates des Caraïbes (© Walt Disney Pictures)</em>

[DNSenum sur PentestLab](https://pentestlab.wordpress.com/2012/07/13/dnsenum-gathering-dns-information/ "DNSenum sur PentestLab")